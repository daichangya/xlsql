# Excel JDBC 驱动命令行界面使用文档

## 1. 概述

Excel JDBC 驱动提供了一个命令行界面（CLI），允许用户通过简单的命令与 Excel 文件进行交互。该界面提供了完整的数据库操作功能，包括连接、查询、导出等操作。

## 2. 启动命令行界面

要启动命令行界面，请运行以下命令：

```bash
java -jar target/exceljdbc-1.0-SNAPSHOT.jar
```


启动后，您将看到欢迎信息和提示符：
```
*** caution: development release ***
Excel JDBC Driver
Copyright 2025 by jsdiff Information Sciences
http://excel.jsdiff.com

xlsql> -idle#
```


## 3. 命令行状态

命令行界面有四种状态：

1. **IDLE** (-idle#) - 初始状态，可以建立连接
2. **CONNECTED** (-connected#) - 已连接到配置实例
3. **READ** (-open read only#) - 以只读方式打开数据库
4. **OPEN** (-open#) - 已打开数据库进行读写操作

## 4. 命令详解

### 4.1 IDLE 状态命令

#### connect (c)
连接到配置实例
```bash
-c config_name
```

示例：
```bash
-c /Users/changyadai/.xlsql/xlsql_config.properties
```


#### help (h)
显示帮助信息
```bash
-h
```


#### quit/exit/bye/q
退出程序
```bash
-quit
```


#### time (t)
显示当前时间
```bash
-t
```


### 4.2 CONNECTED 状态命令

#### disconnect (d)
断开连接
```bash
-d
```


#### engine
管理数据库引擎
```bash
-engine SET engine_name
-engine ADD engine_name
-engine REMOVE engine_name
```

示例：
```bash
-engine SET hsqldb
-engine ADD mysql
-engine REMOVE mysql
```


#### open
打开数据库
```bash
-open /path/to/excel/files
```

或使用简写：
```bash
-o
```


#### ping
测试数据库连接
```bash
-ping
```


#### read (r)
以只读模式打开数据库
```bash
-read /path/to/excel/files
```

或使用简写：
```bash
-r
```


#### set
设置配置参数
```bash
-set parameter value
```

可设置的参数包括：
- log: 日志文件路径
- database: 数据库路径
- engine: 活动引擎
- driver: JDBC 驱动类
- url: 数据库连接URL
- schema: 数据库模式
- user: 用户名
- password: 密码

示例：
```bash
-set database /Users/changyadai/ExcelFiles
-set log /Users/changyadai/xlsql.log
```


#### show
显示配置信息
```bash
-show ALL          # 显示所有配置
-show engine       # 显示当前引擎
-show driver       # 显示驱动信息
-show url          # 显示连接URL
-show schema       # 显示模式
-show user         # 显示用户名
-show password     # 显示密码
```


### 4.3 READ 状态命令

#### cat
显示数据库目录结构
```bash
-cat
```


#### close
关闭当前连接
```bash
-close
```


#### export
导出数据
```bash
-export ALL AS hsqldb TO out
-export test1.Sheet1 AS hsqldb TO jdbc_connection
-export ALL AS XML TO output.xml
```


### 4.4 OPEN 状态命令

#### close
关闭数据库连接
```bash
-close
```


#### dir2xl
将目录结构导入到Excel表中
```bash
-dir2xl all in /Users/changyadai/IdeaProjects/exceljdbc as list to schema.table
-dir2xl files in /Users/changyadai/IdeaProjects/exceljdbc as tree to schema.table
```


#### sql
进入交互式SQL会话
```bash
-sql
```


#### script
执行SQL脚本文件
```bash
-script /path/to/script.sql
```


## 5. 使用示例

### 5.1 基本操作流程

```bash
# 1. 连接到配置实例
-c /Users/changyadai/.xlsql/xlsql_config.properties

# 2. 设置数据库路径
-set database /Users/changyadai/ExcelFiles

# 3. 打开数据库
-open /Users/changyadai/ExcelFiles

# 4. 进入SQL交互模式

-sql

# 6. 执行SQL查询
SELECT * FROM "test.Sheet1";

# 7. 退出SQL模式
quit

# 8. 关闭数据库
-close
```


### 5.2 SQL 交互模式示例

在 `-sql` 模式下，您可以执行标准SQL操作：

```sql
# 查询所有数据
SELECT * FROM "test.Sheet1";

# 条件查询
SELECT * FROM "test.Sheet1" WHERE "column1" = 'value';

# 插入数据
INSERT INTO "test.Sheet1" ("column1", "column2") VALUES ('value1', 'value2');

# 更新数据
UPDATE "test.Sheet1" SET "column1 = 'new_value' WHERE "column2" = 'condition';

# 删除数据
DELETE FROM "test.Sheet1" WHERE "column1" = 'value';

# 创建表
CREATE TABLE "NewSheet" ("ID" INTEGER, "Name" VARCHAR(50));

# 删除表
DROP TABLE "NewSheet";
```


### 5.3 数据导出示例

```bash
# 导出所有数据为HSQLDB格式到控制台
-export ALL AS hsqldb TO out

# 导出特定表为MySQL格式到数据库连接
-export test.Sheet1 AS hsqldb TO out

# 导出为XML格式到文件
-export ALL AS XML TO /Users/changyadai/export.xml
```


### 5.4 目录导入示例

```bash
# 将目录结构作为列表导入
-dir2xl all in /Users/changyadai/Documents as list to directory.files

# 将目录结构作为树形结构导入
-dir2xl files in /Users/changyadai/Documents as tree to directory.filetree
```


## 6. 配置管理

### 6.1 配置文件

系统会自动创建配置文件 `xlsql_config.properties`，包含以下默认配置：

```properties
# 通用设置
general.database=${user.dir}
general.engine=hsqldb
general.log=xlsql.log

# HSQLDB 引擎设置
hsqldb.driver=org.hsqldb.jdbcDriver
hsqldb.url=jdbc:hsqldb:.
hsqldb.schema=
hsqldb.user=sa
hsqldb.password=
```


### 6.2 自定义配置

可以通过系统属性指定配置文件路径：
```bash
java -Dxlsql.config.path=/path/to/custom_config.properties -jar exceljdbc.jar
```


## 7. Excel 文件要求

### 7.1 文件格式
- 支持 `.xls` 格式（Excel 97-2003）
- 部分支持 `.xlsx` 格式

### 7.2 工作表结构
1. 第一行为列标题
2. 标题应使用有效的SQL标识符
3. 避免使用特殊字符和空格
4. 每列应保持数据类型一致

### 7.3 示例Excel结构
```
| Name    | Age | City      |
|---------|-----|-----------|
| John    | 25  | New York  |
| Jane    | 30  | Los Angeles |
```


## 8. 最佳实践

### 8.1 数据操作建议
1. 在执行写操作前备份重要Excel文件
2. 避免在生产环境中直接修改原始数据文件
3. 使用副本文件进行测试操作
4. 定期检查日志文件以监控操作状态

### 8.2 性能优化
1. 对于大型Excel文件，建议使用过滤条件减少数据加载
2. 避免在复杂公式的工作表上执行查询
3. 合理设计查询语句，避免全表扫描

### 8.3 安全建议
1. 保护包含敏感数据的Excel文件
2. 定期更改数据库连接密码
3. 限制对配置文件的访问权限

## 9. 故障排除

### 9.1 常见错误

#### 连接失败
- 检查Excel文件路径是否正确
- 确认文件存在且可访问
- 验证JDBC驱动是否正确加载

#### 权限问题
- 检查文件读写权限
- 确认程序有足够权限访问指定目录

#### 配置错误
- 检查配置文件格式是否正确
- 验证配置参数值是否有效

### 9.2 日志查看
查看日志文件 `xlsql.log` 获取详细错误信息。

## 10. 限制和注意事项

### 10.1 功能限制
1. 不支持复杂的数据类型（如图片、图表等）
2. 不支持Excel公式计算
3. 对大型文件的性能可能较差
4. 并发访问支持有限

### 10.2 数据类型映射
| Excel 类型 | SQL 类型 |
|------------|----------|
| 文本       | VARCHAR  |
| 数字       | NUMERIC  |
| 日期       | DATE     |
| 布尔值     | BOOLEAN  |

---

**注意**: 本文档基于 Excel JDBC 驱动版本 1.0-SNAPSHOT 编写，具体功能可能因版本更新而有所变化。建议在使用前确认当前版本的功能特性。